<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
  body { background-color: #111; color: white; font-family: Arial, sans-serif; margin: 0; padding: 20px; }
  h1 { color: #4CAF50; }
  input, textarea { width: 100%; padding: 8px; margin: 10px 0; border-radius: 6px; border: none; outline: none; font-size: 14px; }
  button { background-color: #4CAF50; color: white; border: none; padding: 8px 14px; border-radius: 6px; cursor: pointer; font-size: 14px; }
  button:hover { background-color: #45a049; }
  .revert { background-color: #d9534f; margin-left: 10px; }
  .revert:hover { background-color: #c9302c; }
  #login-box { text-align: center; margin-top: 100px; }
  #admin-content { display: none; max-width: 600px; margin: auto; }
  label { display: block; margin-top: 20px; font-weight: bold; }
  .group { display: flex; align-items: center; gap: 10px; }
  input[type="color"] { width: 60px; height: 35px; padding: 0; border-radius: 4px; }
</style>
</head>
<body>

<div id="login-box">
  <h2>🔒 Admin Login</h2>
  <input type="email" id="admin-email" placeholder="Enter email..." />
  <input type="password" id="admin-pass" placeholder="Enter password..." />
  <button id="login-btn">Login</button>
</div>

<div id="admin-content">
  <h1>🛠️ Live Site Controls</h1>

  <label>🎨 Background Color:</label>
  <div class="group">
    <input type="color" id="bgColor">
    <button class="revert" id="revert-bg">Revert</button>
  </div>

  <label>🧾 Announcement (HTML supported):</label>
  <div class="group" style="flex-direction: column; align-items: flex-start;">
    <textarea id="announcement" rows="3" placeholder="Enter announcement..."></textarea>
    <div>
      <button id="trigger-announcement">📢 Trigger Announcement</button>
      <button class="revert" id="revert-ann">Revert</button>
    </div>
  </div>

  <label>😱 Jumpscare Image URL:</label>
  <div class="group">
    <input type="text" id="jumpscareImage" placeholder="https://...">
    <button class="revert" id="revert-jumpimg">Revert</button>
  </div>

  <label>🕹️ Trigger Jumpscare Manually:</label>
  <div class="group">
    <button id="trigger-jumpscare">⚡ Trigger Now</button>
  </div>
  
  <div class="group">
    <button id="reset-clickData">🗑️ Reset Most Popular Games</button>
  </div>
  
  <hr style="margin: 30px 0; border: 1px solid #333;">

  <h2>💀 Troll Controls</h2>

  <div class="group">
    <button id="cursor-chaos">🌀 Cursor Chaos</button>
  </div>
  
  <div class="group" style="flex-direction: column; align-items: flex-start;">
    <button id="choose-sound">🎵 Play Sound</button>
    <button id="stop-sound">⏹️ Stop Audio</button>
    <div id="sound-menu" style="display:none; background:#222; padding:10px; border-radius:8px; margin-top:10px; max-height:200px; overflow:auto;"></div>
  </div>

  <div class="group">
    <button id="flashbang">💥 Flashbang Mode</button>
    <button id="reverse-controls">🔄 Reverse Controls</button>
  </div>
  
  <label>👥 Live User Counter:</label>
  <div class="group">
    <span id="user-count">Loading...</span>
  </div>

  <br>
  <button id="save">💾 Save Changes</button>
</div>

<!-- Firebase v9 compat build -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC-IDS2wfF3ZgVzjwf0cHUazNGolLFhXVQ",
  authDomain: "mostpopular-39c60.firebaseapp.com",
  databaseURL: "https://mostpopular-39c60-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "mostpopular-39c60",
  storageBucket: "mostpopular-39c60.appspot.com",
  messagingSenderId: "939775132675",
  appId: "1:939775132675:web:7d40bd8fff497c53553a36",
  measurementId: "G-XTTQ03YFN9"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

const settingsRef = db.ref("siteSettings");
const trollRef = db.ref("trollTriggers");
const usersRef = db.ref("connectedUsers");

// ---------------- LOGIN ----------------
window.onload = () => {
  const loginBtn = document.getElementById("login-btn");
  const emailInput = document.getElementById("admin-email");
  const passInput = document.getElementById("admin-pass");
  const loginBox = document.getElementById("login-box");
  const adminContent = document.getElementById("admin-content");

  loginBtn.onclick = async () => {
    const email = emailInput.value.trim();
    const password = passInput.value.trim();
    if (!email || !password) return alert("❌ Enter email and password!");

    try {
      await auth.signInWithEmailAndPassword(email, password);
      loginBox.style.display = "none";
      adminContent.style.display = "block";

      loadSettings();
      watchUserCount();
      alert("✅ Login successful!");
    } catch (err) {
      console.error(err);
      alert("❌ Login failed: " + err.message);
    }
  };
};

// ---------------- LOAD SETTINGS ----------------
function loadSettings() {
  settingsRef.once("value").then(snapshot => {
    const s = snapshot.val() || { backgroundColor: "#0a0a0a", announcement: "", jumpscareImage: "" };
    document.getElementById("bgColor").value = s.backgroundColor;
    document.getElementById("announcement").value = s.announcement;
    document.getElementById("jumpscareImage").value = s.jumpscareImage;
  });
}

// ---------------- WATCH USERS ----------------
function watchUserCount() {
  usersRef.on("value", snap => {
    document.getElementById("user-count").textContent = snap.numChildren() + " online";
  });
}

// ---------------- SAFE WRITE ----------------
async function safeWrite(ref, data) {
  const user = auth.currentUser;
  if (!user) return alert("❌ You must be logged in!");
  await ref.set(data);
}

// ---------------- SAVE SETTINGS ----------------
document.getElementById("save").onclick = async () => {
  const settings = {
    backgroundColor: document.getElementById("bgColor").value,
    announcement: document.getElementById("announcement").value,
    jumpscareImage: document.getElementById("jumpscareImage").value
  };
  try {
    await safeWrite(settingsRef, settings);
    alert("✅ Changes saved!");
  } catch (err) {
    console.error(err);
    alert("❌ Save failed!");
  }
};

// ---------------- ANNOUNCEMENT ----------------
document.getElementById("trigger-announcement").onclick = async () => {
  const text = document.getElementById("announcement").value.trim();
  if (!text) return alert("❌ No announcement!");
  await safeWrite(db.ref("announcementTriggerNow"), { text, timestamp: Date.now() });
  alert("📢 Announcement triggered!");
};

// ---------------- JUMPSCARE ----------------
document.getElementById("trigger-jumpscare").onclick = async () => {
  const image = document.getElementById("jumpscareImage").value.trim();
  if (!image) return alert("❌ Enter jumpscare image URL!");
  await safeWrite(db.ref("jumpscareTriggerNow"), { image, timestamp: Date.now() });
  alert("😱 Jumpscare triggered!");
};

// ---------------- RESET CLICK DATA ----------------
document.getElementById("reset-clickData").onclick = async () => {
  if (!confirm("⚠️ Reset all Most Popular Games data?")) return;
  await safeWrite(db.ref("clickData"), null);
  alert("✅ Data reset!");
};

// ---------------- TROLL CONTROLS ----------------
document.getElementById("cursor-chaos").onclick = async () => {
  await safeWrite(trollRef.child("cursorChaos"), { active: true, timestamp: Date.now() });
};
document.getElementById("flashbang").onclick = async () => {
  await safeWrite(trollRef.child("flashbang"), { active: true, timestamp: Date.now() });
};
document.getElementById("reverse-controls").onclick = async () => {
  await safeWrite(trollRef.child("reverseControls"), { active: true, timestamp: Date.now() });
};

// ---------------- REVERT BUTTONS ----------------
document.getElementById("revert-bg").onclick = () => document.getElementById("bgColor").value = "#0a0a0a";
document.getElementById("revert-ann").onclick = () => document.getElementById("announcement").value = "";
document.getElementById("revert-jumpimg").onclick = () => document.getElementById("jumpscareImage").value = "";
</script>
</body>
</html>
